/* soma.js - v2.0.4 - 2013-11-06 - http://somajs.github.io/somajs - http://www.soundstep.com */(function(infuse){"use strict";infuse.version="0.6.9";var FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,FN_ARG_SPLIT=/,/,FN_ARG=/^\s*(_?)(\S+?)\1\s*$/,STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;Array.prototype.contains||(Array.prototype.contains=function(value){for(var i=this.length;i--;)if(this[i]===value)return!0;return!1}),infuse.InjectorError={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] the first parameter is invalid, a string is expected",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] the third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] this mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] invalid parameter, a function is expected",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] no mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself"};var MappingVO=function(prop,value,cl,singleton){this.prop=prop,this.value=value,this.cl=cl,this.singleton=singleton||!1},validateProp=function(prop){if("string"!=typeof prop)throw Error(infuse.InjectorError.MAPPING_BAD_PROP)},validateValue=function(prop,val){if(void 0===val||null===val)throw Error(infuse.InjectorError.MAPPING_BAD_VALUE+prop)},validateClass=function(prop,val){if("function"!=typeof val)throw Error(infuse.InjectorError.MAPPING_BAD_CLASS+prop)},validateBooleanSingleton=function(prop,singleton){if("boolean"!=typeof singleton)throw Error(infuse.InjectorError.MAPPING_BAD_SINGLETON+prop)},validateConstructorInjectionLoop=function(name,cl){var params=infuse.getConstructorParams(cl);if(params.contains(name))throw Error(infuse.InjectorError.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},validatePropertyInjectionLoop=function(name,target){if(target.hasOwnProperty(name))throw Error(infuse.InjectorError.INJECT_INSTANCE_IN_ITSELF_PROPERTY)};infuse.Injector=function(){this.mappings={},this.parent=null},infuse.getConstructorParams=function(cl){function extractName(all,underscore,name){args.push(name)}for(var args=[],clStr=(""+cl).replace(STRIP_COMMENTS,""),argsFlat=clStr.match(FN_ARGS),spl=argsFlat[1].split(FN_ARG_SPLIT),i=0;spl.length>i;i++){var arg=spl[i];arg.replace(FN_ARG,extractName)}return args},infuse.Injector.prototype={createChild:function(){var injector=new infuse.Injector;return injector.parent=this,injector},getMappingVo:function(prop){return this.mappings?this.mappings[prop]?this.mappings[prop]:this.parent?this.parent.getMappingVo(prop):null:null},mapValue:function(prop,val){if(this.mappings[prop])throw Error(infuse.InjectorError.MAPPING_ALREADY_EXISTS+prop);return validateProp(prop),validateValue(prop,val),this.mappings[prop]=new MappingVO(prop,val,void 0,void 0),this},mapClass:function(prop,cl,singleton){if(this.mappings[prop])throw Error(infuse.InjectorError.MAPPING_ALREADY_EXISTS+prop);return validateProp(prop),validateClass(prop,cl),singleton&&validateBooleanSingleton(prop,singleton),this.mappings[prop]=new MappingVO(prop,null,cl,singleton),this},removeMapping:function(prop){return this.mappings[prop]=null,delete this.mappings[prop],this},hasMapping:function(prop){return!!this.mappings[prop]},hasInheritedMapping:function(prop){return!!this.getMappingVo(prop)},getMapping:function(value){for(var name in this.mappings)if(this.mappings.hasOwnProperty(name)){var vo=this.mappings[name];if(vo.value===value||vo.cl===value)return vo.prop}return void 0},getValue:function(prop){var vo=this.mappings[prop];if(!vo){if(this.parent)return this.parent.getValue.apply(this.parent,arguments);throw Error(infuse.InjectorError.NO_MAPPING_FOUND)}if(vo.cl){var args=Array.prototype.slice.call(arguments);return args[0]=vo.cl,vo.singleton?(vo.value||(vo.value=this.createInstance.apply(this,args)),vo.value):this.createInstance.apply(this,args)}return vo.value},getClass:function(prop){var vo=this.mappings[prop];return vo?vo.cl?vo.cl:void 0:this.parent?this.parent.getClass(prop):void 0},instantiate:function(TargetClass){if("function"!=typeof TargetClass)throw Error(infuse.InjectorError.CREATE_INSTANCE_INVALID_PARAM);for(var args=[null],params=infuse.getConstructorParams(TargetClass),i=0;params.length>i;i++)if(void 0!==arguments[i+1]&&null!==arguments[i+1])args.push(arguments[i+1]);else{var name=params[i],vo=this.getMappingVo(name);if(vo){var val=this.getInjectedValue(vo,name);args.push(val)}else args.push(void 0)}return new(Function.prototype.bind.apply(TargetClass,args))},inject:function(target,isParent){this.parent&&this.parent.inject(target,!0);for(var name in this.mappings)if(this.mappings.hasOwnProperty(name)){var vo=this.getMappingVo(name);(target.hasOwnProperty(vo.prop)||target.constructor&&target.constructor.prototype&&target.constructor.prototype.hasOwnProperty(vo.prop))&&(target[name]=this.getInjectedValue(vo,name))}return"function"!=typeof target.postConstruct||isParent||target.postConstruct(),this},getInjectedValue:function(vo,name){var injectee,val=vo.value;return vo.cl&&(vo.singleton?(vo.value||(validateConstructorInjectionLoop(name,vo.cl),vo.value=this.instantiate(vo.cl),injectee=vo.value),val=vo.value):(validateConstructorInjectionLoop(name,vo.cl),val=this.instantiate(vo.cl),injectee=val)),injectee&&(validatePropertyInjectionLoop(name,injectee),this.inject(injectee)),val},createInstance:function(){var instance=this.instantiate.apply(this,arguments);return this.inject(instance),instance},getValueFromClass:function(cl){for(var name in this.mappings)if(this.mappings.hasOwnProperty(name)){var vo=this.mappings[name];if(vo.cl===cl)return vo.singleton?(vo.value||(vo.value=this.createInstance.apply(this,arguments)),vo.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw Error(infuse.InjectorError.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw Error("Error, you must bind a function.");var args=Array.prototype.slice.call(arguments,1),bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F,result=target.apply(self,args.concat(Array.prototype.slice.call(arguments)));return Object(result)===result?result:self}return target.apply(that,args.concat(Array.prototype.slice.call(arguments)))};return bound}),"function"==typeof define&&define.amd!==void 0&&define("infuse",infuse),"undefined"!=typeof module&&module.exports!==void 0&&(module.exports=infuse),"undefined"!=typeof exports&&(exports=infuse)})(this.infuse=this.infuse||{}),function(soma){"use strict";soma.events={},soma.events.version="0.5.6",Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw Error("Error, you must bind a function.");var args=Array.prototype.slice.call(arguments,1),bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F,result=target.apply(self,args.concat(Array.prototype.slice.call(arguments)));return Object(result)===result?result:self}return target.apply(that,args.concat(Array.prototype.slice.call(arguments)))};return bound}),soma.Event=function(type,params,bubbles,cancelable){var e=soma.Event.createGenericEvent(type,bubbles,cancelable);return null!==params&&void 0!==params&&(e.params=params),e.isCloned=!1,e.clone=this.clone.bind(e),e.isIE9orIE10=this.isIE9orIE10,e.isDefaultPrevented=this.isDefaultPrevented,(this.isIE9orIE10()||!e.preventDefault||void 0===e.getDefaultPrevented&&void 0===e.defaultPrevented)&&(e.preventDefault=this.preventDefault.bind(e)),this.isIE9orIE10()&&(e.IE9or10PreventDefault=!1),e},soma.Event.prototype.clone=function(){var e=soma.Event.createGenericEvent(this.type,this.bubbles,this.cancelable);return e.params=this.params,e.isCloned=!0,e.clone=this.clone,e.isDefaultPrevented=this.isDefaultPrevented,e.isIE9orIE10=this.isIE9orIE10,this.isIE9orIE10()&&(e.IE9or10PreventDefault=this.IE9or10PreventDefault),e},soma.Event.prototype.preventDefault=function(){return this.cancelable?(this.isIE9orIE10()?this.IE9or10PreventDefault=!0:this.defaultPrevented=!0,this):!1},soma.Event.prototype.isDefaultPrevented=function(){return this.cancelable?this.isIE9orIE10()?this.IE9or10PreventDefault:void 0!==this.defaultPrevented?this.defaultPrevented:void 0!==this.getDefaultPrevented?this.getDefaultPrevented():!1:!1},soma.Event.createGenericEvent=function(type,bubbles,cancelable){var event;return bubbles=void 0!==bubbles?bubbles:!0,"object"==typeof document&&document.createEvent?(event=document.createEvent("Event"),event.initEvent(type,!!bubbles,!!cancelable)):"object"==typeof document&&document.createEventObject?(event=document.createEventObject(),event.type=type,event.bubbles=!!bubbles,event.cancelable=!!cancelable):event=new EventObject(type,!!bubbles,!!cancelable),event},soma.Event.prototype.isIE9orIE10=function(){return"object"!=typeof document?!1:void 0!==document.body.style.scrollbar3dLightColor&&void 0!==document.body.style.opacity||void 0!==document.body.style.msTouchAction},soma.Event.prototype.toString=function(){return"[soma.Event]"};var EventObject=function(type,bubbles,cancelable){this.type=type,this.bubbles=!!bubbles,this.cancelable=!!cancelable,this.defaultPrevented=!1,this.currentTarget=null,this.target=null};soma.EventDispatcher=function(){this.listeners=[]},soma.EventDispatcher.prototype.addEventListener=function(type,listener,priority){if(this.listeners&&type&&listener){isNaN(priority)&&(priority=0);for(var i=0;this.listeners.length>i;i++){var eventObj=this.listeners[i];if(eventObj.type===type&&eventObj.listener===listener)return}this.listeners.push({type:type,listener:listener,priority:priority,scope:this})}},soma.EventDispatcher.prototype.removeEventListener=function(type,listener){if(this.listeners&&type&&listener)for(var i=this.listeners.length;i-->0;){var eventObj=this.listeners[i];eventObj.type===type&&eventObj.listener===listener&&this.listeners.splice(i,1)}},soma.EventDispatcher.prototype.hasEventListener=function(type){if(!this.listeners||!type)return!1;for(var i=0,l=this.listeners.length;l>i;++i){var eventObj=this.listeners[i];if(eventObj.type===type)return!0}return!1},soma.EventDispatcher.prototype.dispatchEvent=function(event){if(!this.listeners||!event)throw Error("Error in EventDispatcher (dispatchEvent), one of the parameters is null or undefined.");var i,events=[];for(i=0;this.listeners.length>i;i++){var eventObj=this.listeners[i];eventObj.type===event.type&&events.push(eventObj)}for(events.sort(function(a,b){return b.priority-a.priority}),i=0;events.length>i;i++)events[i].listener.apply(event.srcElement?event.srcElement:event.currentTarget,[event]);return!event.isDefaultPrevented()},soma.EventDispatcher.prototype.dispatch=function(type,params,bubbles,cancelable){if(!this.listeners||!type||""===type)throw Error("Error in EventDispatcher (dispatch), one of the parameters is null or undefined.");var event=new soma.Event(type,params,bubbles,cancelable);return this.dispatchEvent(event),event},soma.EventDispatcher.prototype.dispose=function(){this.listeners=null},soma.EventDispatcher.prototype.toString=function(){return"[soma.EventDispatcher]"},"function"==typeof define&&define.amd!==void 0&&define("soma-events",soma),"undefined"!=typeof module&&module.exports!==void 0&&(module.exports=soma),"undefined"!=typeof exports&&(exports=soma)}(this.soma=this.soma||{}),function(soma,infuse){"use strict";function parsePath(dataValue,dataPath){if(void 0!==dataPath&&void 0!==dataValue){for(var step,val=dataValue,path=dataPath.split(".");step=path.shift();){var parts=step.match(regexFunction);if(parts){var params=parts[2];params=params.replace(/,\s+/g,"").split(",");for(var i=0,l=params.length;l>i;i++)regexParams.test(params[i])&&(params[i]=params[i].substr(1,params[i].length-2));void 0!==val[parts[1]]&&(val=val[parts[1]].apply(null,params))}else val=val[step]}dataValue=val}return dataValue}function getTypedAttributes(self,element){for(var attr,name,value,list=[],attrs=element.attributes,j=0,jj=attrs&&attrs.length;jj>j;j++)attr=attrs[j],attr.specified&&(name=attr.name,value=attr.value,self.types[name]&&list.push(attr));return list}function getDataFromParentMediators(self,element,dataPath){var target=element.parentNode;if(target){var mediator=self.get(target);if(mediator){var value=parsePath(mediator,dataPath);return void 0!==value?value:getDataFromParentMediators(self,target,dataPath)}}}function parseDOM(self,element){if(element&&element.nodeType&&8!==element.nodeType&&3!==element.nodeType&&void 0!==element.getAttribute){for(var typedList=getTypedAttributes(self,element),i=0,l=typedList.length;l>i;i++){var attr=typedList[i],type=self.types[attr.name];if(attr&&type){var mediatorId=attr.value.split(self.attributeSeparator)[0],mapping=type.getMapping(mediatorId);if(mapping){var dataSource=getDataSource(self,element,type,attr.value);type.get(element)||type.add(element,self.create(type.mappings[mediatorId].mediator,element,dataSource))}}}for(var child=element.firstChild;child;)parseDOM(self,child),child=child.nextSibling}}function getDataSource(self,element,type,attrValue){var dataSource,parts=attrValue.split(self.attributeSeparator),mediatorId=parts[0],dataPath=parts[1],mapping=type.getMapping(mediatorId);return mapping&&(dataSource=resolveDataSource(self,element,type,mediatorId,dataPath)),dataSource}function resolveDataSource(self,element,mediatorType,mediatorId,dataPath){var dataSource=mediatorType.getMappingData(mediatorId)||{};if(dataPath)for(var dataPathList=dataPath.split(/,(?![\w\s'",\\]*\))/g),s=0,d=dataPathList.length;d>s;s++){var p=dataPathList[s].split(":"),name=p[0];dataSource[name]=dataSource[name]?parsePath(dataSource[name],p[1]):getDataFromParentMediators(self,element,p[1])}return dataSource}function applyMappingData(injector,obj){for(var name in obj)"string"==typeof name&&void 0!==obj[name]&&null!==obj[name]&&injector.mapValue(name,obj[name])}soma.version="2.0.4",soma.applyProperties=function(target,extension,bindToExtension,list){if("[object Array]"===Object.prototype.toString.apply(list))for(var i=0,l=list.length;l>i;i++)(void 0===target[list[i]]||null===target[list[i]])&&(target[list[i]]=bindToExtension&&"function"==typeof extension[list[i]]?extension[list[i]].bind(extension):extension[list[i]]);else for(var prop in extension)target[prop]=bindToExtension&&"function"==typeof extension[prop]?extension[prop].bind(extension):extension[prop]},soma.augment=function(target,extension,list){if(extension.prototype&&target.prototype)if("[object Array]"===Object.prototype.toString.apply(list))for(var i=0,l=list.length;l>i;i++)target.prototype[list[i]]||(target.prototype[list[i]]=extension.prototype[list[i]]);else for(var prop in extension.prototype)target.prototype[prop]||(target.prototype[prop]=extension.prototype[prop])},soma.inherit=function(parent,obj){var Subclass;Subclass=obj&&obj.hasOwnProperty("constructor")?obj.constructor:function(){return parent.apply(this,arguments)};var Chain=function(){};return Chain.prototype=parent.prototype,Subclass.prototype=new Chain,obj&&soma.applyProperties(Subclass.prototype,obj),Subclass.prototype.constructor=Subclass,Subclass.parent=parent.prototype,Subclass.extend=function(obj){return soma.inherit(Subclass,obj)},Subclass},soma.extend=function(obj){return soma.inherit(function(){},obj)},soma.browsers=soma.browsers||{},soma.browsers.ie=function(){if("undefined"==typeof document)return void 0;var div=document.createElement("div");if(div.style.msTouchAction!==void 0)return 10;for(var v=3,all=div.getElementsByTagName("i");div.innerHTML="<!--[if gt IE "+ ++v+"]><i></i><![endif]-->",all[0];);return v>4?v:void 0}(),soma.utils=soma.utils||{},soma.utils.HashMap=function(id){function uuid(){return++count}function getKey(target){if(target){if("object"!=typeof target)return target;var result;try{result=target[id]?target[id]:target[id]=uuid()}catch(err){}return result}}var items={},count=0;this.remove=function(key){delete items[getKey(key)]},this.get=function(key){return items[getKey(key)]},this.put=function(key,value){items[getKey(key)]=value},this.has=function(key){return items[getKey(key)]!==void 0},this.getData=function(){return items},this.dispose=function(){for(var key in items)items.hasOwnProperty(key)&&delete items[key]}};var regexFunction=/(.*)\((.*)\)/,regexParams=/^(\"|\')(.*)(\"|\')$/,plugins=[];soma.plugins=soma.plugins||{},soma.plugins.add=function(plugin){plugins.push(plugin)},soma.plugins.remove=function(plugin){for(var i=plugins.length-1,l=0;i>=l;i--)plugin===plugins[i]&&plugins.splice(i,1)},"undefined"==typeof MutationObserver&&"undefined"!=typeof window&&window.WebKitMutationObserver!==void 0&&(window.MutationObserver=window.WebKitMutationObserver||window.MozMutationObserver),soma.Application=soma.extend({constructor:function(){function setup(){self.injector=new infuse.Injector(self.dispatcher),self.dispatcher=new soma.EventDispatcher,self.injector.mapValue("injector",self.injector),self.injector.mapValue("instance",self),self.injector.mapValue("dispatcher",self.dispatcher),self.injector.mapClass("mediators",Mediators,!0),self.mediators=self.injector.getValue("mediators"),self.injector.mapClass("commands",Commands,!0),self.commands=self.injector.getValue("commands");for(var i=0,l=plugins.length;l>i;i++)self.createPlugin(plugins[i])}var self=this;setup(),this.init(),this.start()},createPlugin:function(){if(0===arguments.length||!arguments[0])throw Error("Error creating a plugin, plugin class is missing.");for(var params=infuse.getConstructorParams(arguments[0]),args=[arguments[0]],i=0;params.length>i;i++)(this.injector.hasMapping(params[i])||this.injector.hasInheritedMapping(params[i]))&&args.push(this.injector.getValue(params[i]));for(var j=1;arguments.length>j;j++)args.push(arguments[j]);return this.injector.createInstance.apply(this.injector,args)},init:function(){},start:function(){},dispose:function(){this.injector&&(this.injector.removeMapping("injector"),this.injector.removeMapping("dispatcher"),this.injector.removeMapping("mediators"),this.injector.removeMapping("commands"),this.injector.removeMapping("instance")),this.injector&&this.injector.dispose(),this.dispatcher&&this.dispatcher.dispose(),this.mediators&&this.mediators.dispose(),this.commands&&this.commands.dispose(),this.injector=void 0,this.dispatcher=void 0,this.mediators=void 0,this.commands=void 0,this.instance=void 0}});var MediatorType=soma.extend({constructor:function(name,injector){this.name=name,this.injector=injector,this.mappings={},this.list=new soma.utils.HashMap("hm-"+name)},map:function(id,mediator,data){return this.mappings[id]||"function"!=typeof mediator||(this.mappings[id]={mediator:mediator,data:data}),this},unmap:function(id){return this.mappings[id]&&(delete this.mappings[id].mediator,delete this.mappings[id].data,delete this.mappings[id]),this},hasMapping:function(id){return void 0!==this.mappings[id]&&null!==this.mappings[id]},getMapping:function(id){return this.mappings[id]},getMappingData:function(id){if(this.mappings[id]){var data=this.mappings[id].data;if(void 0!==data){if("function"==typeof data)return data;var resolvedData={};for(var name in data)resolvedData[name]="string"==typeof data[name]&&this.injector.hasMapping(data[name])?this.injector.getValue(data[name]):data[name];return resolvedData}}},has:function(element){return this.list.has(element)},add:function(element,mediator){this.list.has(element)||this.list.put(element,{mediator:mediator,element:element})},remove:function(element){var item=this.list.get(element);item&&(item.mediator&&"function"==typeof item.mediator.dispose&&item.mediator.dispose(),delete item.mediator,delete item.element,this.list.remove(element))},get:function(element){var item=this.list.get(element);return item&&item.mediator?item.mediator:void 0},removeAll:function(){this.list&&this.list.dispose()},dispose:function(){}}),Mediators=soma.extend({constructor:function(){this.types={},this.defaultType="data-mediator",this.attributeSeparator="|",this.injector=null,this.dispatcher=null,this.isObserving=!1,this.observer=null},postConstruct:function(){this.describe(this.defaultType)},describe:function(name){if(this.types[name])throw Error("The type of mediator has been described already ("+name+").");return this.types[name]=new MediatorType(name,this.injector),this.types[name]},create:function(cl,target,data){if(!cl||"function"!=typeof cl)throw Error("Error creating a mediator, the first parameter must be a function.");if(void 0===target||null===target)throw Error("Error creating a mediator, the second parameter cannot be undefined or null.");var targets=[],list=[];target.length>0?targets=target:targets.push(target);for(var i=0,l=targets.length;l>i;i++){var injector=this.injector.createChild();if(injector.mapValue("target",targets[i]),"function"==typeof data){var result=data(injector,i);void 0!==result&&null!==result&&applyMappingData(injector,result)}else void 0!==data&&null!==data&&applyMappingData(injector,data);var mediator=injector.createInstance(cl);if(1===targets.length)return mediator;list.push(mediator)}return list},getType:function(name){var typeId=name?name:this.defaultType;if(!this.types[typeId])throw Error("The type of mediator has been not been found ("+typeId+").");return this.types[typeId]},removeType:function(){},map:function(id,mediator,data,type){return this.getType(type).map(id,mediator,data)},unmap:function(id,type){return this.getType(type).unmap(id)},hasMapping:function(id,type){return this.getType(type).hasMapping(id)},getMapping:function(id,type){return this.getType(type).getMapping(id)},getMappingData:function(id,type){return this.getType(type).getMappingData(id)},observe:function(element,parse,config){(void 0===parse||null===parse||parse)&&this.parse(element),"undefined"!=typeof MutationObserver&&element?(this.observer=new MutationObserver(function(mutations){for(var i=0,l=mutations.length;l>i;i++){var mutationType=mutations[i].type;switch(mutationType){case"childList":console.log(">> [mutation][childList]",mutations[i]);for(var added=mutations[i].addedNodes,j=0,k=added.length;k>j;j++)this.parse(added[j]);for(var removed=mutations[i].removedNodes,d=0,f=removed.length;f>d;d++)this.parseToRemove(removed[j]);break;case"attributes":console.log(">> [mutation][attribute]",mutations[i]);var attrName=mutations[i].attributeName,type=this.types[attrName],target=mutations[i].target;if(type&&type.has(target)){console.log("type has target:",type.has(target));var attrValue=mutations[i].target.getAttribute(attrName),dataSource=getDataSource(this,element,type,attrValue),mediator=type.get(target);if(dataSource&&mediator){var injector=this.injector.createChild();if(injector.mapValue("target",target),"function"==typeof dataSource){var result=dataSource(injector,i);void 0!==result&&null!==result&&applyMappingData(injector,result)}else void 0!==dataSource&&null!==dataSource&&applyMappingData(injector,dataSource);injector.inject(mediator,!1)}}}}}.bind(this)),this.observer.observe(element,config||{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["data-mediator","data-hover"]}),this.isObserving=!0):(this.observer&&this.observer.disconnect(),this.observer=null,this.isObserving=!1)},parseToRemove:function(element){if(element&&element.nodeType&&8!==element.nodeType&&3!==element.nodeType&&void 0!==element.getAttribute){for(var typeId in this.types){var attr=element.getAttribute(typeId);if(attr){var parts=attr.split(this.attributeSeparator);parts[0]&&this.types[typeId].has(element)&&this.types[typeId].hasMapping(parts[0])&&this.types[typeId].remove(element)}}for(var child=element.firstChild;child;)this.parseToRemove(child),child=child.nextSibling}},parse:function(element){if(element&&element.nodeType&&8!==element.nodeType&&3!==element.nodeType&&void 0!==element.getAttribute&&(parseDOM(this,element),"undefined"==typeof MutationObserver)){var dataList=this.list.getData();for(var el in dataList){var item=dataList[el],element=item.element;(!element.parentNode||"undefined"!=typeof HTMLDocument&&element.parentNode&&element.parentNode instanceof HTMLDocument)&&this.remove(element)}}},support:function(element){"undefined"==typeof MutationObserver&&this.parse(element)},add:function(element,mediator,type){this.getType(type).add(element,mediator)},remove:function(element,type){this.getType(type).remove(element)},get:function(element,type){var mediator=this.getType(type).get(element);if(mediator)return mediator;for(var typeId in this.types){var m=this.types[typeId].get(element);if(m)return m}},has:function(element,type){return this.getType(type).has(element)},removeAll:function(type){this.getType(type).removeAll()},dispose:function(){this.observer&&this.observer.disconnect();for(var id in this.types)this.types[id].removeAll();this.injector=void 0,this.dispatcher=void 0,this.observer=void 0,this.list=void 0}}),Commands=soma.extend({constructor:function(){this.boundHandler=this.handler.bind(this),this.dispatcher=null,this.injector=null,this.list={}},has:function(commandName){return null!==this.list[commandName]&&void 0!==this.list[commandName]},get:function(commandName){return this.has(commandName)?this.list[commandName]:void 0},getAll:function(){var copy={};for(var cmd in this.list)this.list.hasOwnProperty(cmd)&&(copy[cmd]=this.list[cmd]);return copy},add:function(commandName,command){if("string"!=typeof commandName)throw Error("Error adding a command, the first parameter must be a string.");if("function"!=typeof command)throw Error('Error adding a command with the name "'+command+'", the second parameter must be a function, and must contain an "execute" public method.');if(this.has(commandName))throw Error('Error adding a command with the name: "'+commandName+'", already registered.');this.list[commandName]=command,this.addInterceptor(commandName)},remove:function(commandName){this.has(commandName)&&(this.list[commandName]=void 0,delete this.list[commandName],this.removeInterceptor(commandName))},removeAll:function(){for(var cmd in this.list)this.list.hasOwnProperty(cmd)&&this.remove(cmd)},addInterceptor:function(commandName){this.dispatcher.addEventListener(commandName,this.boundHandler,-Number.MAX_VALUE)},removeInterceptor:function(commandName){this.dispatcher.removeEventListener(commandName,this.boundHandler)},handler:function(event){event.isDefaultPrevented&&!event.isDefaultPrevented()&&this.executeCommand(event)},executeCommand:function(event){var commandName=event.type;if(this.has(commandName)){var command=this.injector.createInstance(this.list[commandName]);if(!command.hasOwnProperty("execute")&&"function"===command.execute)throw Error("Error in "+this+" Command "+command+" must contain an execute public method.");command.execute(event)}},dispose:function(){this.removeAll(),this.boundHandler=void 0,this.dispatcher=void 0,this.injector=void 0,this.list=void 0}});soma.EventDispatcher.extend=function(obj){return soma.inherit(soma.EventDispatcher,obj)},soma.Event.extend=function(obj){return soma.inherit(soma.Event,obj)},infuse.Injector.extend=function(obj){return soma.inherit(infuse.Injector,obj)},"function"==typeof define&&define.amd!==void 0&&define("soma",soma),"undefined"!=typeof module&&module.exports!==void 0?module.exports=soma:window.soma=soma}(this.soma=this.soma||{},this.infuse);